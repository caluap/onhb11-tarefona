<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/reset.css" />
    <link rel="stylesheet" href="css/onhb11_tarefona.css" />

    <!-- <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script> -->
    <script src="js/jquery-3.1.1.min.js"></script>
    <script src="js/mustache.min.js"></script>

    <meta name="theme-color" content="#cb0772" />

    <script>
      var viewUrl = "json/teste_tarefona.json";
      let templateUrl = "template.mustache";

      jQuery(function($) {
        var body = $("#here-comes-treble");

        $.when(
          $.get(viewUrl),
          $.get({ url: templateUrl, dataType: "text" })
        ).then(function(data, template) {
          data = data[0];
          Mustache.parse(template[0]);

          var i,
            subData = data["PohDoneActivity"]["submitted_data"];
          for (i in subData) {
            if (i.match(/^img_/)) {
              try {
                subData[i + "_versions"] =
                  data["PohDoneActivity"]["attachments"][subData[i]].versions;
              } catch (e) {}
            } else if (typeof subData[i] === "string") {
              if (subData[i].length > 0) {
                subData[i] = subData[i]
                  .replace(/"([^"]*)"/gm, "“$1”")
                  .split("\n");
              } else {
                delete subData[i];
              }
            }
          }

          data._isDone = function(data) {
            return this.PohDoneActivity.status === "delivered";
          };

          var rendered = Mustache.render(template[0], data);

          body.html(rendered);
          body.show();
        });
      });
    </script>
  </head>
  <body>
    <div id="toolbar">
      <div class="form-control">
        <label>Leiaute</label>
        <select
          class="select-css"
          onchange="changeClass(this, '#layout-template')"
        >
          <option value="jean-luc">Jean Luc</option>
          <option value="infini">Infini</option>
          <option value="syne">Syne</option>
        </select>
      </div>
      <div class="form-control">
        <label>Paleta</label>
        <select
          class="select-css"
          onchange="changeClass(this, '#color-palette'); changeMap(this)"
        >
          <option value="sol-de-segunda">Sol de segunda</option>
          <option value="paisagem-celta">Paisagem celta</option>
          <option value="sol-de-sabado">Sol de sábado</option>
          <option value="a-solidao-das-pedras">A solidão das pedras</option>
        </select>
      </div>
      <div class="button-container">
        <button>Salvar rascunho</button>
      </div>
    </div>
    <div id="here-comes-treble"></div>
    <script>
      function changeMap(who) {
        let iNewImg = who.selectedIndex + 1;
        let currentSrc = $("#state-map").attr("src");
        let iStr = currentSrc.indexOf("mapa_cor") + "mapa_cor".length;
        let newStr =
          currentSrc.substring(0, iStr) +
          iNewImg +
          currentSrc.substring(iStr + 1);
        $("#state-map").attr("src", newStr);
      }
      function changeClass(who, affectedDiv) {
        $(affectedDiv)
          .removeClass()
          .addClass(who.value);
      }
    </script>
  </body>
</html>
